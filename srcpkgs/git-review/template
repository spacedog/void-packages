# Template file for 'git-review'
pkgname=git-review
version=2.2.0
revision=1
build_style=python3-module
hostmakedepends="python3-setuptools python3-pbr"
depends="python3-requests"
checkdepends="openjdk-jre openssh git tox procps-ng which"
short_desc="Git command for submitting branches to Gerrit"
maintainer="Orphaned <orphan@voidlinux.org>"
license="Apache-2.0"
homepage="https://git.openstack.org/cgit/openstack-infra/git-review/"
distfiles="${PYPI_SITE}/g/${pkgname}/${pkgname}-${version}.tar.gz"
checksum=fd97a00e5c15173eb097cef8e8b7915df96d878ad11eb62cb44983642b8f3a63

do_check() {
	# Remove su - part
	sed -i '/f.write(GOLDEN_SITE_VER)/a \        utils.run_cmd("sed", "-i", "s/su - $GERRIT_USER -s//", self._dir("gsite", "bin", "gerrit.sh"))' git_review/tests/__init__.py

	mkdir -p ~/.ssh && echo -e "Host *\n  HostkeyAlgorithms +ssh-rsa\n  PubkeyAcceptedAlgorithms +ssh-rsa" > ~/.ssh/config
	tox -e py3 -vv --skip-missing-interpreters=false
}
